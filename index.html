<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Simulasi E-Money NFC</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { margin: 5px; padding: 10px 20px; }
    .hidden { display: none; }
    .popup {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #eee;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      z-index: 10;
    }
  </style>
</head>
<body>
  <h2>Simulasi E-Money NFC</h2>

  <div id="namaTokoContainer">
    <label>Masukkan Nama Toko: </label>
    <input type="text" id="namaTokoInput" />
    <button onclick="simpanNamaToko()">Masuk</button>
  </div>

  <div id="app" class="hidden">
    <button onclick="checkSaldo()">Check Saldo</button>
    <div id="saldoDisplay"></div>

    <button onclick="bukaTransaksi()">Transaksi</button>
    <div id="transaksiForm" class="hidden">
      <input id="hargaInput" placeholder="Masukkan harga" oninput="formatHarga(this)" />
      <button onclick="prosesTransaksi()">Proses</button>
    </div>

    <button onclick="tampilInfo()">Informasi Toko</button>
    <div id="infoToko" class="hidden">
      <p id="namaTokoText"></p>
      <p id="saldoTokoText"></p>
      <button onclick="bukaRedeem()">Redeem</button>
      <div id="redeemForm" class="hidden">
        <input type="password" placeholder="Password admin" id="redeemPass" />
        <button onclick="prosesRedeem()">Konfirmasi</button>
        <p><i>Ini hanya bisa diisi oleh admin</i></p>
      </div>
    </div>
  </div>

  <div id="popupMessage" class="popup hidden"></div>

  <script>
    let saldoKartu = 500000;
    let saldoToko = 0;
    let namaToko = '';

    const popup = document.getElementById('popupMessage');

    function showPopup(msg) {
      popup.innerText = msg;
      popup.classList.remove('hidden');
      setTimeout(() => {
        popup.classList.add('hidden');
      }, 2000);
    }

    function simpanNamaToko() {
      namaToko = document.getElementById('namaTokoInput').value;
      if (namaToko.trim() === '') return alert('Masukkan nama toko');
      document.getElementById('namaTokoContainer').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
    }

    function formatRupiah(angka) {
      return angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    function formatHarga(el) {
      let angka = el.value.replace(/\D/g, '');
      el.value = formatRupiah(angka);
    }

    function checkSaldo() {
      tutupSemuaForm();
      showPopup(`Saldo kartu: Rp ${formatRupiah(saldoKartu)}`);
    }

    function bukaTransaksi() {
      tutupSemuaForm();
      document.getElementById('transaksiForm').classList.remove('hidden');
    }

    function prosesTransaksi() {
      const input = document.getElementById('hargaInput').value.replace(/\./g, '');
      const harga = parseInt(input);

      if (isNaN(harga) || harga <= 0) {
        showPopup("Harga tidak valid");
        return;
      }

      if (saldoKartu >= harga) {
        saldoKartu -= harga;
        saldoToko += harga;
        showPopup("Transaksi berhasil");
      } else {
        showPopup("Saldo tidak cukup");
      }

      setTimeout(() => {
        document.getElementById('transaksiForm').classList.add('hidden');
        document.getElementById('hargaInput').value = '';
      }, 2000);
    }

    function tampilInfo() {
      tutupSemuaForm();
      document.getElementById('infoToko').classList.remove('hidden');
      document.getElementById('namaTokoText').innerText = `Nama Toko: ${namaToko}`;
      document.getElementById('saldoTokoText').innerText = `Saldo Toko: Rp ${formatRupiah(saldoToko)}`;
    }

    function bukaRedeem() {
      document.getElementById('redeemForm').classList.remove('hidden');
    }

    function prosesRedeem() {
      const pass = document.getElementById('redeemPass').value;
      if (pass === 'admin123') {
        saldoToko = 0;
        tampilInfo();
        showPopup("Redeem berhasil");
      } else {
        showPopup("Password salah");
      }
    }

    function tutupSemuaForm() {
      document.getElementById('transaksiForm').classList.add('hidden');
      document.getElementById('infoToko').classList.add('hidden');
      document.getElementById('redeemForm').classList.add('hidden');
    }
  </script>
</body>
</html>
